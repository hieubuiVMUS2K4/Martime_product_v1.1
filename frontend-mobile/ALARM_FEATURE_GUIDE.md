# HÆ°á»›ng dáº«n chá»©c nÄƒng BÃ¡o Ä‘á»™ng an toÃ n

## ğŸ“± Tá»•ng quan

Chá»©c nÄƒng **Safety Alarm Management** (Quáº£n lÃ½ bÃ¡o Ä‘á»™ng an toÃ n) cho phÃ©p thuyá»n viÃªn:
- Xem danh sÃ¡ch bÃ¡o Ä‘á»™ng Ä‘ang hoáº¡t Ä‘á»™ng (chÆ°a giáº£i quyáº¿t)
- XÃ¡c nháº­n Ä‘Ã£ nháº­n biáº¿t bÃ¡o Ä‘á»™ng
- ÄÃ¡nh dáº¥u bÃ¡o Ä‘á»™ng Ä‘Ã£ Ä‘Æ°á»£c giáº£i quyáº¿t
- Xem lá»‹ch sá»­ bÃ¡o Ä‘á»™ng
- Xem thá»‘ng kÃª bÃ¡o Ä‘á»™ng theo nhiá»u tiÃªu chÃ­

---

## ğŸš€ CÃ¡ch sá»­ dá»¥ng

### 1. Truy cáº­p chá»©c nÄƒng

**CÃ¡ch 1:** Tá»« mÃ n hÃ¬nh Dashboard
- Nháº¥n vÃ o card **"BÃ¡o Ä‘á»™ng an toÃ n"** trong pháº§n "Truy cáº­p nhanh"

**CÃ¡ch 2:** Tá»« Menu (Drawer)
- Má»Ÿ menu bÃªn trÃ¡i (nháº¥n â˜°)
- Chá»n **"BÃ¡o Ä‘á»™ng an toÃ n"** (biá»ƒu tÆ°á»£ng ğŸ”” mÃ u Ä‘á»)

---

### 2. MÃ n hÃ¬nh danh sÃ¡ch bÃ¡o Ä‘á»™ng

#### Thá»‘ng kÃª tá»•ng quan (cards trÃªn Ä‘áº§u)
- **NghiÃªm trá»ng** (Ä‘á»): Sá»‘ lÆ°á»£ng alarm má»©c CRITICAL chÆ°a giáº£i quyáº¿t
- **Cáº£nh bÃ¡o** (cam): Sá»‘ lÆ°á»£ng alarm má»©c WARNING chÆ°a giáº£i quyáº¿t  
- **ChÆ°a xÃ¡c nháº­n** (xanh): Sá»‘ lÆ°á»£ng alarm chÆ°a Ä‘Æ°á»£c acknowledge

#### Danh sÃ¡ch bÃ¡o Ä‘á»™ng
Má»—i card hiá»ƒn thá»‹:
- **Má»©c Ä‘á»™ nghiÃªm trá»ng**: CRITICAL (Ä‘á»), WARNING (cam), INFO (xanh)
- **Badge "Má»šI"**: BÃ¡o Ä‘á»™ng chÆ°a Ä‘Æ°á»£c xÃ¡c nháº­n
- **Loáº¡i bÃ¡o Ä‘á»™ng**: ğŸ”¥ Há»a hoáº¡n, ğŸ’§ NÆ°á»›c háº§m, âš™ï¸ MÃ¡y mÃ³c, ğŸ§­ HÃ ng háº£i...
- **MÃ´ táº£**: Chi tiáº¿t sá»± cá»‘
- **Vá»‹ trÃ­**: Buá»“ng mÃ¡y, Khoang lÃ¡i, Boong tÃ u...
- **MÃ£ bÃ¡o Ä‘á»™ng**: FIRE-001, BILGE-002...
- **Thá»i gian**: "5 phÃºt trÆ°á»›c", "2 giá» trÆ°á»›c"...
- **Tráº¡ng thÃ¡i xÃ¡c nháº­n**: "ÄÃ£ xÃ¡c nháº­n bá»Ÿi Chief Engineer"

#### TÃ­nh nÄƒng
- **Pull to refresh**: KÃ©o xuá»‘ng Ä‘á»ƒ lÃ m má»›i
- **Nháº¥n vÃ o card**: Xem chi tiáº¿t bÃ¡o Ä‘á»™ng
- **NÃºt âŸ²**: LÃ m má»›i danh sÃ¡ch
- **NÃºt ğŸ“Š**: Xem thá»‘ng kÃª
- **NÃºt ğŸ•’**: Xem lá»‹ch sá»­

---

### 3. MÃ n hÃ¬nh chi tiáº¿t bÃ¡o Ä‘á»™ng

#### ThÃ´ng tin hiá»ƒn thá»‹
1. **Header**: Má»©c Ä‘á»™ + Loáº¡i bÃ¡o Ä‘á»™ng vá»›i mÃ u sáº¯c ná»•i báº­t
2. **Badge "Cáº¦N XÃC NHáº¬N"**: Náº¿u chÆ°a acknowledge
3. **MÃ´ táº£ chi tiáº¿t**: ThÃ´ng tin Ä‘áº§y Ä‘á»§ vá» sá»± cá»‘
4. **Vá»‹ trÃ­**: Khu vá»±c xáº£y ra sá»± cá»‘
5. **MÃ£ bÃ¡o Ä‘á»™ng**: MÃ£ Ä‘á»‹nh danh
6. **Thá»i gian phÃ¡t sinh**: NgÃ y giá» chÃ­nh xÃ¡c + thá»i gian trÃ´i qua
7. **Tráº¡ng thÃ¡i**: ChÆ°a xá»­ lÃ½ / ÄÃ£ xÃ¡c nháº­n / ÄÃ£ giáº£i quyáº¿t

#### ThÃ´ng tin xÃ¡c nháº­n (náº¿u Ä‘Ã£ acknowledge)
- NgÆ°á»i xÃ¡c nháº­n
- Thá»i gian xÃ¡c nháº­n

#### ThÃ´ng tin giáº£i quyáº¿t (náº¿u Ä‘Ã£ resolve)
- Thá»i gian giáº£i quyáº¿t

#### HÃ nh Ä‘á»™ng

**NÃºt "XÃ¡c nháº­n" (âœ“)** - MÃ u xanh lÃ¡
- Hiá»‡n khi: BÃ¡o Ä‘á»™ng chÆ°a Ä‘Æ°á»£c xÃ¡c nháº­n
- Chá»©c nÄƒng: XÃ¡c nháº­n Ä‘Ã£ biáº¿t vá» bÃ¡o Ä‘á»™ng
- LÆ°u: TÃªn ngÆ°á»i xÃ¡c nháº­n (tá»« profile) + thá»i gian

**NÃºt "Giáº£i quyáº¿t" (âœ“âœ“)** - MÃ u xanh dÆ°Æ¡ng  
- Hiá»‡n khi: BÃ¡o Ä‘á»™ng Ä‘Ã£ xÃ¡c nháº­n nhÆ°ng chÆ°a giáº£i quyáº¿t
- Chá»©c nÄƒng: ÄÃ¡nh dáº¥u Ä‘Ã£ xá»­ lÃ½ xong sá»± cá»‘
- CÃ³: Dialog xÃ¡c nháº­n trÆ°á»›c khi thá»±c hiá»‡n

---

### 4. MÃ n hÃ¬nh thá»‘ng kÃª

#### Bá»™ lá»c thá»i gian
Chá»n khoáº£ng thá»i gian: **7 ngÃ y**, **30 ngÃ y**, **90 ngÃ y**

#### Thá»‘ng kÃª tá»•ng quan (4 cards)
- **Tá»•ng sá»‘**: Táº¥t cáº£ bÃ¡o Ä‘á»™ng
- **Äang hoáº¡t Ä‘á»™ng**: ChÆ°a giáº£i quyáº¿t
- **ÄÃ£ xÃ¡c nháº­n**: ÄÃ£ acknowledge
- **ÄÃ£ giáº£i quyáº¿t**: ÄÃ£ resolve

#### Biá»ƒu Ä‘á»“ phÃ¢n tÃ­ch

**1. Theo má»©c Ä‘á»™ nghiÃªm trá»ng**
- CRITICAL: MÃ u Ä‘á»
- WARNING: MÃ u cam
- INFO: MÃ u xanh
- Hiá»ƒn thá»‹: Progress bar + sá»‘ lÆ°á»£ng + pháº§n trÄƒm

**2. Theo loáº¡i bÃ¡o Ä‘á»™ng**
- FIRE, BILGE, ENGINE, NAVIGATION, SAFETY, SECURITY...
- MÃ u: Indigo
- Hiá»ƒn thá»‹: Progress bar + sá»‘ lÆ°á»£ng + pháº§n trÄƒm

**3. Theo vá»‹ trÃ­**
- ENGINE_ROOM, BRIDGE, DECK, GALLEY...
- MÃ u: Teal
- Hiá»ƒn thá»‹: Progress bar + sá»‘ lÆ°á»£ng + pháº§n trÄƒm

---

### 5. MÃ n hÃ¬nh lá»‹ch sá»­

#### Bá»™ lá»c
Chá»n: **7 ngÃ y**, **30 ngÃ y**, **90 ngÃ y**

#### Danh sÃ¡ch lá»‹ch sá»­
Hiá»ƒn thá»‹ táº¥t cáº£ bÃ¡o Ä‘á»™ng (Ä‘Ã£ giáº£i quyáº¿t + chÆ°a giáº£i quyáº¿t)

Má»—i card cÃ³:
- Icon theo má»©c Ä‘á»™ nghiÃªm trá»ng
- TÃªn loáº¡i bÃ¡o Ä‘á»™ng
- NgÃ y giá» phÃ¡t sinh
- MÃ´ táº£
- Vá»‹ trÃ­
- **Badge tráº¡ng thÃ¡i**:
  - "ÄÃ£ giáº£i quyáº¿t" (âœ“) - Xanh lÃ¡
  - "ÄÃ£ xÃ¡c nháº­n" (âœ“) - Xanh dÆ°Æ¡ng

#### TÃ­nh nÄƒng
- **Pull to refresh**: KÃ©o xuá»‘ng Ä‘á»ƒ lÃ m má»›i
- **Nháº¥n vÃ o card**: Xem chi tiáº¿t
- **Sáº¯p xáº¿p**: Má»›i nháº¥t trÆ°á»›c

---

## ğŸ¨ MÃ u sáº¯c & Ã nghÄ©a

### Má»©c Ä‘á»™ nghiÃªm trá»ng
- ğŸ”´ **CRITICAL** (Äá»): Nguy hiá»ƒm nghiÃªm trá»ng, cáº§n xá»­ lÃ½ ngay
- ğŸŸ  **WARNING** (Cam): Cáº£nh bÃ¡o, cáº§n chÃº Ã½
- ğŸ”µ **INFO** (Xanh): ThÃ´ng tin, khÃ´ng kháº©n cáº¥p

### Loáº¡i bÃ¡o Ä‘á»™ng
- ğŸ”¥ **FIRE**: Há»a hoáº¡n
- ğŸ’§ **BILGE**: NÆ°á»›c háº§m
- âš™ï¸ **ENGINE**: MÃ¡y mÃ³c
- ğŸ§­ **NAVIGATION**: HÃ ng háº£i
- âš ï¸ **SAFETY**: An toÃ n
- ğŸ”’ **SECURITY**: Báº£o máº­t

### Vá»‹ trÃ­
- **ENGINE_ROOM**: Buá»“ng mÃ¡y
- **BRIDGE**: Khoang lÃ¡i
- **DECK**: Boong tÃ u
- **GALLEY**: Báº¿p
- **MACHINERY_SPACE**: Khu mÃ¡y mÃ³c
- **CARGO_HOLD**: Khoang hÃ ng

---

## ğŸ”§ API Endpoints (cho dev)

### Backend Ä‘ang cháº¡y
```
Server: http://localhost:5000
Database: PostgreSQL (port 5433)
```

### Danh sÃ¡ch API

#### 1. Láº¥y bÃ¡o Ä‘á»™ng Ä‘ang hoáº¡t Ä‘á»™ng
```http
GET /api/alarms/active
```
Tráº£ vá»: Táº¥t cáº£ alarms chÆ°a resolve (IsResolved = false)

#### 2. Láº¥y lá»‹ch sá»­ bÃ¡o Ä‘á»™ng
```http
GET /api/alarms/history?days=7
```
Parameters:
- `days`: Sá»‘ ngÃ y láº¥y lá»‹ch sá»­ (default: 7)

#### 3. XÃ¡c nháº­n bÃ¡o Ä‘á»™ng
```http
POST /api/alarms/{id}/acknowledge
Content-Type: application/json

{
  "acknowledgedBy": "TÃªn ngÆ°á»i xÃ¡c nháº­n"
}
```

#### 4. Giáº£i quyáº¿t bÃ¡o Ä‘á»™ng
```http
POST /api/alarms/{id}/resolve
```

#### 5. Láº¥y thá»‘ng kÃª
```http
GET /api/alarms/statistics?days=30
```
Parameters:
- `days`: Sá»‘ ngÃ y thá»‘ng kÃª (default: 30)

#### 6. Táº¡o bÃ¡o Ä‘á»™ng máº«u (DEV)
```http
POST /api/alarms/test/generate-sample
```
Táº¡o 5 alarm máº«u vá»›i cÃ¡c má»©c Ä‘á»™ vÃ  tráº¡ng thÃ¡i khÃ¡c nhau

#### 7. Táº¡o bÃ¡o Ä‘á»™ng thá»§ cÃ´ng (DEV)
```http
POST /api/alarms/create
Content-Type: application/json

{
  "alarmType": "FIRE",
  "alarmCode": "FIRE-001",
  "severity": "CRITICAL",
  "location": "ENGINE_ROOM",
  "description": "High temperature detected"
}
```

---

## ğŸ“Š Database Schema

### Table: SafetyAlarms
```sql
CREATE TABLE "SafetyAlarms" (
    "Id" SERIAL PRIMARY KEY,
    "Timestamp" TIMESTAMP NOT NULL,
    "AlarmType" VARCHAR(50) NOT NULL,
    "AlarmCode" VARCHAR(50),
    "Severity" VARCHAR(20) NOT NULL,
    "Location" VARCHAR(100),
    "Description" TEXT,
    "IsAcknowledged" BOOLEAN DEFAULT FALSE,
    "AcknowledgedBy" VARCHAR(100),
    "AcknowledgedAt" TIMESTAMP,
    "IsResolved" BOOLEAN DEFAULT FALSE,
    "ResolvedAt" TIMESTAMP,
    "IsSynced" BOOLEAN DEFAULT FALSE,
    "CreatedAt" TIMESTAMP DEFAULT NOW(),
    "UpdatedAt" TIMESTAMP
);
```

---

## ğŸ§ª Testing

### 1. Táº¡o dá»¯ liá»‡u máº«u
```bash
curl -X POST http://localhost:5000/api/alarms/test/generate-sample
```

### 2. Kiá»ƒm tra alarm Ä‘ang hoáº¡t Ä‘á»™ng
```bash
curl http://localhost:5000/api/alarms/active
```

### 3. XÃ¡c nháº­n alarm
```bash
curl -X POST http://localhost:5000/api/alarms/5/acknowledge \
  -H "Content-Type: application/json" \
  -d '{"acknowledgedBy":"Test User"}'
```

### 4. Giáº£i quyáº¿t alarm
```bash
curl -X POST http://localhost:5000/api/alarms/5/resolve
```

---

## ğŸ¯ Luá»“ng xá»­ lÃ½ bÃ¡o Ä‘á»™ng

```
1. PhÃ¡t sinh bÃ¡o Ä‘á»™ng
   â†“
2. Hiá»‡n trong danh sÃ¡ch ACTIVE
   â”œâ”€ Badge "Má»šI"
   â”œâ”€ Border mÃ u theo severity (Ä‘á»/cam/xanh)
   â””â”€ Sáº¯p xáº¿p: CRITICAL > WARNING > INFO > Timestamp
   â†“
3. Thuyá»n viÃªn nháº¥n vÃ o card
   â†“
4. Xem chi tiáº¿t
   â†“
5. Nháº¥n nÃºt "XÃ¡c nháº­n" âœ“
   â”œâ”€ LÆ°u: AcknowledgedBy + AcknowledgedAt
   â”œâ”€ IsAcknowledged = true
   â””â”€ Badge "Má»šI" biáº¿n máº¥t
   â†“
6. Xá»­ lÃ½ sá»± cá»‘ thá»±c táº¿
   â†“
7. Nháº¥n nÃºt "Giáº£i quyáº¿t" âœ“âœ“
   â”œâ”€ XÃ¡c nháº­n qua dialog
   â”œâ”€ LÆ°u: ResolvedAt
   â”œâ”€ IsResolved = true
   â””â”€ XÃ³a khá»i danh sÃ¡ch ACTIVE
   â†“
8. BÃ¡o Ä‘á»™ng chuyá»ƒn sang HISTORY
```

---

## ğŸ“± Screenshots Flow

### 1. Dashboard â†’ BÃ¡o Ä‘á»™ng an toÃ n
```
[Dashboard]
  â”œâ”€ Thá»‘ng kÃª nhiá»‡m vá»¥
  â””â”€ Truy cáº­p nhanh
      â””â”€ [ğŸ”” BÃ¡o Ä‘á»™ng an toÃ n] â† Nháº¥n vÃ o Ä‘Ã¢y
```

### 2. Danh sÃ¡ch bÃ¡o Ä‘á»™ng
```
[Alarm List Screen]
  â”œâ”€ Header: "BÃ¡o Ä‘á»™ng an toÃ n"
  â”œâ”€ Actions: [ğŸ“Š Statistics] [ğŸ•’ History]
  â”œâ”€ Summary Cards: [NghiÃªm trá»ng: 2] [Cáº£nh bÃ¡o: 1] [ChÆ°a xÃ¡c nháº­n: 3]
  â””â”€ Danh sÃ¡ch:
      â”œâ”€ [ğŸ”¥ FIRE-005 | CRITICAL | Má»šI | 5 phÃºt trÆ°á»›c]
      â”œâ”€ [ğŸ”¥ FIRE-001 | CRITICAL | Má»šI | 30 phÃºt trÆ°á»›c]
      â””â”€ [ğŸ’§ BILGE-002 | WARNING | ÄÃ£ xÃ¡c nháº­n | 2 giá» trÆ°á»›c]
```

### 3. Chi tiáº¿t bÃ¡o Ä‘á»™ng
```
[Alarm Detail Screen]
  â”œâ”€ Header: [âš ï¸ NGHIÃŠM TRá»ŒNG - ğŸ”¥ Há»a hoáº¡n]
  â”œâ”€ Badge: [Cáº¦N XÃC NHáº¬N]
  â”œâ”€ MÃ´ táº£: "High temperature detected in main engine exhaust"
  â”œâ”€ Vá»‹ trÃ­: Buá»“ng mÃ¡y
  â”œâ”€ MÃ£: FIRE-001
  â”œâ”€ Thá»i gian: 29/10/2025 18:01:08 (30 phÃºt trÆ°á»›c)
  â””â”€ FAB: [âœ“ XÃ¡c nháº­n]
```

### 4. Sau khi xÃ¡c nháº­n
```
[Alarm Detail Screen]
  â”œâ”€ ThÃ´ng tin xÃ¡c nháº­n:
  â”‚   â”œâ”€ NgÆ°á»i xÃ¡c nháº­n: Nguyá»…n VÄƒn A
  â”‚   â””â”€ Thá»i gian: 29/10/2025 18:35:00
  â””â”€ FAB: [âœ“âœ“ Giáº£i quyáº¿t]
```

---

## âš ï¸ LÆ°u Ã½

1. **YÃªu cáº§u káº¿t ná»‘i máº¡ng**: Chá»©c nÄƒng nÃ y cáº§n káº¿t ná»‘i vá»›i Edge Server
2. **TÃªn ngÆ°á»i xÃ¡c nháº­n**: Láº¥y tá»« SharedPreferences (crew_name)
3. **XÃ¡c nháº­n trÆ°á»›c khi giáº£i quyáº¿t**: Pháº£i acknowledge trÆ°á»›c khi resolve
4. **Real-time**: Dá»¯ liá»‡u khÃ´ng tá»± Ä‘á»™ng refresh, cáº§n pull-to-refresh hoáº·c nháº¥n nÃºt refresh
5. **Sorting**: Active alarms tá»± Ä‘á»™ng sáº¯p xáº¿p theo má»©c Ä‘á»™ nghiÃªm trá»ng

---

## ğŸš€ TÃ­nh nÄƒng má»Ÿ rá»™ng (Future)

- [ ] Push notification khi cÃ³ bÃ¡o Ä‘á»™ng má»›i
- [ ] Ã‚m thanh/rung khi bÃ¡o Ä‘á»™ng CRITICAL
- [ ] Real-time updates qua WebSocket/SignalR
- [ ] ThÃªm áº£nh/video vÃ o bÃ¡o Ä‘á»™ng
- [ ] Ghi chÃº khi xÃ¡c nháº­n/giáº£i quyáº¿t
- [ ] Export bÃ¡o cÃ¡o PDF
- [ ] Dashboard thá»‘ng kÃª nÃ¢ng cao
- [ ] Offline mode vá»›i sync queue

---

## ğŸ“š TÃ i liá»‡u liÃªn quan

- **Backend API**: `edge-services/Controllers/AlarmsController.cs`
- **Database Schema**: `edge-services/Data/EdgeModels.cs` (SafetyAlarm)
- **Mobile Models**: `lib/data/models/safety_alarm.dart`
- **UI Screens**: `lib/presentation/screens/alarms/`
- **Provider**: `lib/presentation/providers/alarm_provider.dart`

---

**NgÃ y táº¡o**: 29/10/2025  
**Version**: 1.0  
**Author**: GitHub Copilot
